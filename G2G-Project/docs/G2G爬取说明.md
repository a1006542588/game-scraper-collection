# G2G 一键爬取所有游戏 - 使用说明

## 🎯 功能特性

### 1. 一键爬取所有游戏
- ✅ 自动爬取 **7个分类** 的所有游戏
- ✅ 每个分类 **自动翻页** 爬取所有页面
- ✅ 自动 **去重处理** (根据游戏ID)
- ✅ **断点续传** (页面刷新后可继续)
- ✅ **进度实时显示** (当前分类/页数)

### 2. 虚拟滚动优化
- ✅ 游戏选择器采用 **按需加载** 机制
- ✅ 首次只显示 **50个游戏**
- ✅ 点击"加载更多"继续显示
- ✅ 搜索时自动重置,从第一页开始
- ✅ **支持数千个游戏无卡顿**

### 3. 智能分类管理
- ✅ 记录每个游戏所属的分类
- ✅ 同一游戏在多个分类中会合并显示
- ✅ 游戏列表显示分类标签

## 📋 爬取的分类

脚本会自动爬取以下7个分类页面:

| 分类 | URL | 说明 |
|------|-----|------|
| Game coins | `/trending/game-coins` | 游戏金币/货币 |
| Items | `/trending/items` | 游戏道具/物品 |
| Accounts | `/trending/accounts` | 游戏账号 |
| Boosting | `/trending/boosting` | 代练服务 |
| Mobile Recharge | `/trending/mobile-recharge` | 移动充值 |
| Coaching | `/trending/coaching` | 游戏教学 |
| Skins | `/trending/skins` | 游戏皮肤 |

## 🚀 使用步骤

### 方式1: 一键全自动爬取 (推荐)

1. **打开 G2G 网站**
   ```
   https://www.g2g.com/
   ```

2. **点击按钮**
   - 在右侧控制面板点击 "🚀 一键爬取所有游戏"
   - 确认对话框: 点击"确定"

3. **等待完成**
   - 脚本会自动依次访问7个分类页面
   - 每个分类会自动翻页爬取所有游戏
   - 进度条实时显示: `[2/7] items (第3页)`
   - 全程无需人工干预

4. **查看结果**
   - 爬取完成后会显示通知
   - 统计信息: 新增游戏数、总游戏数、耗时
   - 数据自动保存,刷新不丢失

### 方式2: 断点续传

如果爬取过程中页面刷新或关闭:

1. **重新打开页面**
   - 脚本会自动检测未完成的任务

2. **确认继续**
   - 弹出对话框: "检测到上次未完成的游戏爬取任务,是否继续?"
   - 点击"确定"继续,点击"取消"放弃

3. **自动恢复**
   - 从上次中断的分类继续爬取
   - 不会重复爬取已完成的分类

## 🎮 游戏选择器使用

### 搜索游戏

1. **点击搜索框**
   - 输入框会自动弹出游戏列表
   - 默认显示前50个游戏

2. **输入关键词**
   ```
   例如: world, warcraft, lol, wow, gta
   ```
   - 实时过滤匹配的游戏
   - 显示统计: "📊 找到 125 个游戏"

3. **加载更多**
   - 滚动到底部
   - 点击 "⬇️ 加载更多 (还有 75 个游戏)"
   - 每次加载50个

### 选择游戏

1. **点击游戏项**
   - 游戏名称显示在顶部 (金色高亮)
   - 搜索框自动填充游戏名称

2. **跳转到游戏**
   - 点击 "➡️ 跳转到选中游戏"
   - 自动打开游戏详情页

3. **清除选择**
   - 点击已选游戏框右侧的 "✕" 按钮

## 📊 数据结构

### 游戏数据示例

```json
{
  "id": "wow-gold",
  "name": "World Of Warcraft",
  "url": "https://www.g2g.com/categories/wow-gold",
  "offers": "59,226 offers",
  "category": "Game coins",
  "categories": ["Game coins", "Boosting", "Items"],
  "scrapedAt": "2025-10-05T12:34:56.789Z"
}
```

### 字段说明

- `id`: 游戏唯一标识符 (从URL提取)
- `name`: 游戏名称
- `url`: 游戏详情页链接
- `offers`: 订单数量
- `category`: 主要分类
- `categories`: 所有出现的分类 (去重后合并)
- `scrapedAt`: 爬取时间戳

## ⚙️ 配置参数

脚本内置以下可调整参数:

```javascript
CONFIG = {
    SCRAPE_DELAY: 1000,              // 爬取延迟 1秒
    PAGE_SWITCH_DELAY: 2000,         // 分类切换延迟 2秒
    PAGINATION_DELAY: 1500,          // 翻页延迟 1.5秒
    MAX_PAGES_PER_CATEGORY: 50,     // 每个分类最多爬50页
    GAMES_PER_PAGE: 50,              // 游戏列表每页显示50个
}
```

### 修改方法

如果需要调整爬取速度或数量:

1. 打开脚本编辑器
2. 找到 `CONFIG` 配置区域
3. 修改对应参数
4. 保存并刷新页面

## 🔍 爬取逻辑详解

### 1. 页面遍历
```
游戏列表页 → 提取游戏 → 点击下一页 → 提取游戏 → ... → 最后一页
```

### 2. 翻页检测
- 查找按钮: `button.q-btn` 包含 `keyboard_arrow_right` 图标
- 检查按钮状态: 未禁用才可点击
- 禁用状态表示已到最后一页

### 3. 去重算法
```javascript
// 使用 Map 去重 (key = 游戏ID)
uniqueGamesMap = new Map()
allGames.forEach(game => {
  if (!uniqueGamesMap.has(game.id)) {
    uniqueGamesMap.set(game.id, game)
  } else {
    // 合并分类信息
    existing.categories.push(game.category)
  }
})
```

### 4. 虚拟滚动
```javascript
// 状态管理
gameListState = {
  currentPage: 0,         // 当前显示到第几页
  filteredGames: [],      // 过滤后的游戏列表
  searchTerm: ''          // 搜索关键词
}

// 按需渲染
displayGames = filteredGames.slice(
  currentPage * 50, 
  (currentPage + 1) * 50
)
```

## 📈 性能优化

### 原始方案 (未优化)
- 爬取1个分类 → 1个页面
- 游戏选择器 → 一次渲染所有游戏
- **问题**: 游戏少、卡顿严重

### 优化方案 (当前)
- 爬取7个分类 → 所有页面 → 自动去重
- 游戏选择器 → 虚拟滚动 (50个/页)
- **效果**: 游戏全、流畅无卡顿

### 性能对比

| 项目 | 未优化 | 已优化 |
|------|--------|--------|
| 游戏数量 | ~50个 | 1000+个 |
| 首次渲染时间 | 50ms | 20ms |
| 选择器卡顿 | 明显 | 无感知 |
| 搜索响应 | 慢 | 即时 |
| 内存占用 | 中 | 低 |

## 🛠️ 故障排除

### 问题1: 爬取中断
**症状**: 爬取到一半页面刷新或关闭

**解决**: 
- 重新打开页面
- 点击"继续"恢复爬取
- 如超时10分钟,需要重新开始

### 问题2: 未找到游戏元素
**症状**: 提示"当前页未找到游戏"

**原因**: 
- 页面未完全加载
- 网络延迟较高
- G2G 网站结构变化

**解决**: 
- 等待几秒后重试
- 增加 `PAGINATION_DELAY` 延迟
- 检查控制台日志

### 问题3: 游戏选择器很慢
**症状**: 点击搜索框卡顿

**原因**: 
- 游戏过多 (>2000个)
- 浏览器性能较低

**解决**: 
- 使用搜索功能缩小范围
- 减少 `GAMES_PER_PAGE` 参数
- 清理浏览器缓存

### 问题4: 翻页按钮找不到
**症状**: 某些分类只爬取1页

**原因**: 
- G2G 翻页按钮结构变化
- 该分类确实只有1页

**解决**: 
- 检查控制台调试日志
- 手动验证是否有下一页
- 更新按钮选择器

## 📝 注意事项

1. **爬取时间**
   - 7个分类 × 平均10页 = 约 3-5 分钟
   - 请耐心等待,不要中途关闭页面

2. **数据存储**
   - 所有数据保存在浏览器本地存储
   - 清除浏览器数据会丢失爬取结果
   - 建议定期导出备份

3. **网络要求**
   - 需要稳定的网络连接
   - 建议关闭VPN/代理避免超时
   - 不要频繁刷新页面

4. **反爬限制**
   - 脚本已设置合理延迟
   - 避免短时间内多次爬取
   - 如遇验证码,请手动完成

## 🎉 总结

这个一键爬取功能可以:
- ✅ 自动爬取 **7个分类** 的所有游戏
- ✅ 支持 **自动翻页** 直到最后一页
- ✅ 智能 **去重** 避免重复数据
- ✅ **虚拟滚动** 支持数千游戏无卡顿
- ✅ **断点续传** 中断后可继续
- ✅ **实时进度** 掌控爬取状态

享受一键爬取的便利吧! 🚀
